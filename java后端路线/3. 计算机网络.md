# TCP/IP

> https://blog.csdn.net/qq_41517936/article/details/80886618

四层模型从上往下:

- 应用层, FTP, DNS HTTP
- 传输层, TCP, UDP
- 网络层, IP, 
- 链路层

发送端协议封装过程

引用层: Http报文=TCP数据

传输层: TCP首部+HTTP报文=IP数据

网络层: IP首部+IP数据=IP包

链路层: 以太网首部+IP包

## ARP协议

**ARP 地址解析协议**, 通过ip获取MAC地址, ip在网络层, mac是数据链路层

**工作流程: **

ARP协议发送一个ARP请求, 是一个广播数据帧, 局域网内每一台机器都能收到, 数据帧中包含目的主机的ip, 拥有这个ip的主机会反馈消息, 发送自己的硬件地址, 之后要发这个ip的包都发向这个地址

**ARP报各字段含义:**

| 48      | 48    | 16     | 16       | 16       | 8            | 8            | 16         | 48         | 32     | 48           | 32           |
| ------- | ----- | ------ | -------- | -------- | ------------ | ------------ | ---------- | ---------- | ------ | ------------ | ------------ |
| 目标mac | 源mac | 帧类型 | 硬件类型 | 协议类型 | 硬件地址长度 | 协议地址长度 | 源硬件地址 | 源协议地址 | 操作码 | 目标硬件地址 | 目标协议地址 |

目的mac和源mac: 全1, 即ff:ff:::::::ff

帧类型: 2字节, ARP是`0x0806`，对于IP数据报是`0x0800`，还有RARP（逆地址解析协议）是`0x8035`

硬件类型和协议类型: 描述ARP分组的, 硬件类型指代需要什么样的物理地址, 协议类型则是需要映射的协议地址类型, 硬件ip需要mac则填入1, 协议类型填`0x0800`

硬件地址长度和协议地址长度: 分别填6和4, 表示48bit以太网地址, 32bitip地址

操作码: 1->ARP, 2->ARP应答, 3->RARP请求, 4->RARP应答

**ARP高速缓存**

每个主机都有ARP高速缓存, 请求过一次的就会存入缓存中

**ARP代理**

目的网络ip与源ip不在一个网段, 需要路由器转发

如果在同一网段: 有缓存, 直接发, 无缓存, 先发ARP, 缓存后再发;

不在同一网段: 有默认网关缓存, 直接发网关, 无缓存, 先发ARP, 缓存网关mac后再发

**ARP欺骗**

发送大量假ARP应答, mac是假mac, ip是真ip, 这样网关缓存的就是假的地址, 后续包都无法发送到正确的地址;

**ARP命令**

arp -a查看本地arp缓存

## IP/ICMP协议

### IP协议

tcp/ip不是一个协议, 是一个协议族的统称, 包括ip,icmp,tcp,http,ftp,pop3等

ip协议主要研究ip数据包结构

ipv4: 32位, 4段每段8位

ipv6:128位, 8段每段16位, 一个段中前导0不必写, 全0的块用::代替, 兼容ipv4, 最后32位写ipv4内容其余写f, 

ipv4分五大类地址: 

- A类: 第一组0~127的ip地址, 二进制看是首位为0
- B类: 前两位10, 128-191
- C类: 110, 192-223
- D类: 1110, 224-239
- E类: 1111, 240-255

ip分网络号, 子网id, 主机id

子网掩码: 根据二进制首位判断第几类网, 子网掩码全1对应网络号和子网id, 全0对应主机号, 

子网掩码与ip按位与可以得子网号

每一个子网的第一个和最后一个地址无效, 第一个地址表示网关, 最后一个地址表示广播地址

前缀CIDR: 这个是没有分类说法的, 前缀为网络号, 其余表示主机号, 如128.0.0.0/24

特殊用途ip: 整个127网段都是送回主机的地址

组播地址使用D类网, 使用组播地址作为目的地址, 已加入组的主机都能收到该数据包

ip协议:

版本4位, 首部长度4位(存整个首部32位字的数量, 正常值: 5(可变为0) , 最大值为15), 区分服务6位, ECN拥塞标识符2位, 总长度16位(整个数据报的总长度字节为单位)

标识16位(存数据报, 标志3位, 片偏移13位

## TCP/UDP协议

### TCP 可靠传输

三次握手策略

发送端先发一个带SYN标志的数据包, 对方接收到后回发一个带SYN/ACK标志数据包, 最后发送端再发一个带ACK标志的数据包, 代表握手成功









## DNS/HTTP/HTTPS协议

### DNS 

域名与IP之间的解析服务

### HTTP

是一种不保存状态的协议, 每当有新请求发送时就会有新响应产生, 保证大量处理业务

协议职责: 生成针对目标web服务器的http请求报文



**URI**:统一资源标识符

URI是由某个协议方案标识的资源的定位标识符, 比如http, ftp, telnet

URI用字符串标识某一互联网资源, URL标识资源的地址, URL是URI的子集

## Session/Cookie

